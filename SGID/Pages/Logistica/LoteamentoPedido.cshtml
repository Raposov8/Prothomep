@page "{id}"
@model SGID.Pages.Logistica.LoteamentoPedidoModel
@{
    ViewData["Title"] = "Liberar Agendamento";
    if (User.IsInRole("Diretoria") && !User.IsInRole("Admin"))
    {
        Layout = "_LayoutDiretoria";
    }
    else
    {
        Layout = "_LayoutNovo";
    }

    var count = 0;
    var countPatri = 0;
    var countAvulso = 0;
}


<div class="row">
    <div class="col-md-6">
        <h2 style="padding-left:20px;">Consultas</h2>
    </div>
    <div class="col-md-6" style="text-align: right;">
        <a class="produto" onClick="MyWindow=window.open('/produtos/listarprodutos','MyWindow','width=900,height=600'); return false;"><i class="fa-solid fa-money-bills"></i> Consulta Produtos</a>
    </div>
</div>

@using (@Html.BeginForm(FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    <div class="row">
        <div class="card" style="padding:10px;">
            <div class="col-md-12">
                <div class="row">
                    <div class="row">
                        <div class="col-md-8">
                            <h4>Confirmar Produtos</h4>
                        </div>
                        <div class="col-md-4" style="justify-content:end">
                            <div class="row">
                                <label class="col-md-5">Nome Vendedor:</label>
                                <input class="col-md-7 form-control" id="NomeVendedor" name="NomeVendedor" value="@Model.Agendamento.Vendedor" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="col-md-12 Titulo">
                                <span>DADOS DO PACIENTE</span>
                            </div>
                            <input hidden id="id" name="id" value="@Model.Agendamento.Id" />
                            <input hidden id="Reprovado" name="Reprovado" value="0" />
                            <input hidden id="CodTabela" name="CodTabela" value="@Model.Agendamento.CodTabela" />
                            <input hidden id="Empresa" name="Empresa" value="@Model.Agendamento.Empresa" />
                            <div class="row">
                                <div class="col-md-3">
                                    <label class="col-md-12" style="font-size:12px;">Nome Paciente</label>
                                    <input class="col-md-12 form-control" id="NomePaciente" name="NomePaciente" value="@Model.Agendamento.Paciente" />
                                </div>
                                <div class="col-md-3">
                                    <label class="col-md-12" style="font-size:12px;">Nome Hospital</label>
                                    <input class="col-md-12 form-control" id="NomeHospital" name="NomeHospital" value="@Model.Agendamento.Hospital" />
                                </div>
                                <div class="col-md-3">
                                    <label class="col-md-12" style="font-size:12px;">Data da Cirurgia</label>
                                    <input type="datetime-local" class="col-md-12 form-control" id="DataCirurgia" name="DataCirurgia" />
                                </div>
                                <div class="col-md-2">
                                    <label class="col-md-12" style="font-size:12px;">Liminar</label>
                                    <select class="col-md-12 form-control" id="Liminar" name="Liminar">
                                        <option value="2">NÃO</option>
                                        <option value="1">SIM</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="row">
                                <div class="col-md-12 Titulo">
                                    <span>DADOS DO MÉDICO</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="col-md-12" style="font-size:12px;">Nome Médico</label>
                                    <input class="col-md-12 form-control" id="NomeMedico" name="NomeMedico" value="@Model.Agendamento.Medico" />
                                </div>
                                <div class="col-md-6">
                                    <label class="col-md-12" style="font-size:12px;">CRM</label>
                                    <input class="col-md-12 form-control" id="CRM" name="CRM" value="@Model.Crm" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="col-md-12" style="font-size:12px;">Procedimento</label>
                                    <input class="col-md-12 form-control" id="Procedimento" name="Procedimento" value="@Model.Agendamento.Procedimento" />
                                </div>
                                <div class="col-md-3">
                                    <label class="col-md-12" style="font-size:12px;">Data da Entrega</label>
                                    <input type="datetime-local" class="col-md-12 form-control" id="Entrega" name="Entrega" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="panel">
                        <div class="panel-body">
                            <table id="Observacao" name="Observacao" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th class="text-center">
                                            Usuario
                                        </th>
                                        <th class="text-center">
                                            Data
                                        </th>
                                        <th class="text-center">
                                            Observação
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var data in Model.Observacoes)
                                    {
                                        <tr>
                                            <td>
                                                @data.User.Replace(".", " ").ToUpper()
                                            </td>
                                            <td>
                                                @if (data.DataCriacao.ToString("dd/MM/yyyy HH:mm:ss") != "01/01/0001 00:00:00")
                                                {
                                                    <span>@data.DataCriacao.ToString("dd/MM/yyyy HH:mm:ss")</span>
                                                }
                                                else
                                                {
                                                    <span>"NÃO HA REGISTRO"</span>
                                                }
                                            </td>
                                            <td>
                                                @data.Obs
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-md-12 Titulo">AVULSOS(S)</div>
                        <div class="panel">
                            <div class="panel-body">
                                <table id="Avulsos" name="Avulsos" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                    <thead>
                                        <tr style="background-color:#5b9bd5; color:white;">
                                            <th class="text-center">
                                                Código
                                            </th>
                                            <th class="text-center">
                                                Descrição
                                            </th>
                                            <th class="text-center">
                                                Qtd.
                                            </th>
                                            <th class="text-center">
                                                Lote
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var data in Model.Avulsos)
                                        {
                                            <tr>
                                                <td class="text-center">
                                                    @data.Item
                                                    <input type="hidden" id="Avulsos[@countAvulso].Item" name="Avulsos[@countAvulso].Item" value="@data.Item" />
                                                </td>
                                                <td class="text-center">
                                                    @data.Produtos
                                                    <input type="hidden" id="Avulsos[@countAvulso].Produtos" name="Avulsos[@countAvulso].Produtos" value="@data.Produtos" />
                                                </td>
                                                <td class="text-center">
                                                    <input type="number" id="Avulsos[@countAvulso].Und" name="Avulsos[@countAvulso].Und" value="@data.Und" />
                                                </td>
                                                <td class="text-center">
                                                    <select class="form-control" id="Avulsos[@countAvulso].Lote" name="Avulsos[@countAvulso].Lote">
                                                        <option hidden></option>
                                                        @foreach(var lote in data.Lotes)
                                                        {
                                                            <option value="@lote" selected="@(data.Lote == lote)">@lote</option>
                                                        }
                                                    </select>
                                                </td>
                                            </tr>
                                            countAvulso++;
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div style="color:#00b050" class="col-md-2">
                            <button class="btn btn-button btn-success float-end" style="font-size:12px;" type="submit"><i class="fa-solid fa-paper-plane"></i> Confirmar Lotes</button>
                            <a class="btn btn-button btn-danger" href="/logistica/listarlogistica/@Model.Agendamento.Empresa/3" style="font-size:12px;"><i class="fa-solid fa-x"></i> Voltar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@section Scripts {
    <script>
        var count = @count;
        var countPatri = @countPatri;
        var countAvulso = @countAvulso;
        var data = "";
        $(document).ready(function () {

            @if (Model.Agendamento.DataCirurgia != null)
        {
            @:data = "@Model.Agendamento.DataCirurgia.Value.ToString("yyyy-MM-dd'T'HH:mm")";

            @:console.log(data);

            @:$("#DataCirurgia").val(data);
        }
            @if (Model.Agendamento.DataEntrega != null)
        {
            @:data2 = "@Model.Agendamento.DataEntrega.Value.ToString("yyyy-MM-dd'T'HH:mm")";

            @:console.log(data2);

            @:$("#Entrega").val(data2);
        }

        })
    </script>

    <script>

        $(document).ready(function () {
            $(window).keydown(function (event) {
                if (event.keyCode == 13) {
                    event.preventDefault();
                    return false;
                }
            });
        });
    </script>
}